from __future__ import annotations

import aiohttp
import pytest
from pixiv_metadata.__main__ import (
    get_pid,
    get_metadata,
    get_extra_tags,
    extract_tags,
    gen_note,
)


@pytest.fixture
async def session():
    async with aiohttp.ClientSession() as ret:
        yield ret


@pytest.fixture(scope="module")
def metadata():
    return {
        "illustId": "103287719",
        "illustTitle": "2022å¹´12æœˆ ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«",
        "illustComment": "2022å¹´12æœˆæœ«ã«é€šè²©ã§é ’å¸ƒäºˆå®šã®ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚<br /><br />ã€Œæ¹¯ã‘ã‚€ã‚Šã¨å…µç³§ä¸¸ã€ã§ãŠäº’ã„ã«å‹˜é•ã„ã—ãŸã¾ã¾æ—…é¤¨ã«å…¥ã£ã¦ã—ã¾ã£ãŸã‚·ã‚«ãƒ†ãƒãŒé›°å›²æ°—ã«æµã•ã‚Œã¡ã‚ƒã†R18æœ¬ã€‚<br /><br />ã€Œã‚†ã‘ã‚€ã‚Šã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒ³/B5/24P/400å††/R18ã€<br /><br />ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼",
        "id": "103287719",
        "title": "2022å¹´12æœˆ ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«",
        "description": "2022å¹´12æœˆæœ«ã«é€šè²©ã§é ’å¸ƒäºˆå®šã®ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚<br /><br />ã€Œæ¹¯ã‘ã‚€ã‚Šã¨å…µç³§ä¸¸ã€ã§ãŠäº’ã„ã«å‹˜é•ã„ã—ãŸã¾ã¾æ—…é¤¨ã«å…¥ã£ã¦ã—ã¾ã£ãŸã‚·ã‚«ãƒ†ãƒãŒé›°å›²æ°—ã«æµã•ã‚Œã¡ã‚ƒã†R18æœ¬ã€‚<br /><br />ã€Œã‚†ã‘ã‚€ã‚Šã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒ³/B5/24P/400å††/R18ã€<br /><br />ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼",
        "illustType": 1,
        "createDate": "2022-12-02T15:48:29+00:00",
        "uploadDate": "2022-12-02T15:48:29+00:00",
        "restrict": 0,
        "xRestrict": 1,
        "sl": 6,
        "urls": {
            "mini": "https://i.pximg.net/c/48x48/img-master/img/2022/12/03/00/48/29/103287719_p0_square1200.jpg",
            "thumb": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/29/103287719_p0_square1200.jpg",
            "small": "https://i.pximg.net/c/540x540_70/img-master/img/2022/12/03/00/48/29/103287719_p0_master1200.jpg",
            "regular": "https://i.pximg.net/img-master/img/2022/12/03/00/48/29/103287719_p0_master1200.jpg",
            "original": "https://i.pximg.net/img-original/img/2022/12/03/00/48/29/103287719_p0.jpg",
        },
        "tags": {
            "authorId": "10002432",
            "isLocked": False,
            "tags": [
                {
                    "tag": "R-18",
                    "locked": True,
                    "deletable": False,
                    "userId": "10002432",
                    "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
                },
                {
                    "tag": "æ¼«ç”»",
                    "locked": True,
                    "deletable": False,
                    "userId": "10002432",
                    "translation": {"en": "manga"},
                    "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
                },
                {
                    "tag": "ãƒ†ãƒãƒª",
                    "locked": True,
                    "deletable": False,
                    "userId": "10002432",
                    "translation": {"en": "temari"},
                    "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
                },
                {
                    "tag": "ã‚·ã‚«ãƒ†ãƒ",
                    "locked": True,
                    "deletable": False,
                    "userId": "10002432",
                    "translation": {"en": "Shikamaru/Temari"},
                    "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
                },
                {
                    "tag": "ã‚·ã‚«ãƒãƒ«",
                    "locked": True,
                    "deletable": False,
                    "userId": "10002432",
                    "translation": {"en": "shikamaru"},
                    "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
                },
                {
                    "tag": "å¥ˆè‰¯ã‚·ã‚«ãƒãƒ«",
                    "locked": True,
                    "deletable": False,
                    "userId": "10002432",
                    "translation": {"en": "å¥ˆè‰¯é¹¿ä¸¸"},
                    "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
                },
                {
                    "tag": "NARUTO",
                    "locked": True,
                    "deletable": False,
                    "userId": "10002432",
                    "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
                },
                {
                    "tag": "R18",
                    "locked": True,
                    "deletable": False,
                    "userId": "10002432",
                    "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
                },
            ],
            "writable": False,
        },
        "alt": "ãƒ¢ãƒªãƒˆãƒ¼çš„æ¼«ç”»",
        "storableTags": [
            "0xsDLqCEW6",
            "_hSAdpN9rx",
            "EewdJ7G0yf",
            "SxXLk6BxWY",
            "hvlhgsqCKv",
            "bpJ4_WW86s",
            "4LfBhWYcxv",
            "6n5sWl9nNm",
        ],
        "userId": "10002432",
        "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
        "userAccount": "noahnoah8972",
        "userIllusts": {
            "103287719": {
                "id": "103287719",
                "title": "2022å¹´12æœˆ ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«",
                "illustType": 1,
                "xRestrict": 1,
                "restrict": 0,
                "sl": 6,
                "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/29/103287719_p0_square1200.jpg",
                "description": "2022å¹´12æœˆæœ«ã«é€šè²©ã§é ’å¸ƒäºˆå®šã®ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚<br /><br />ã€Œæ¹¯ã‘ã‚€ã‚Šã¨å…µç³§ä¸¸ã€ã§ãŠäº’ã„ã«å‹˜é•ã„ã—ãŸã¾ã¾æ—…é¤¨ã«å…¥ã£ã¦ã—ã¾ã£ãŸã‚·ã‚«ãƒ†ãƒãŒé›°å›²æ°—ã«æµã•ã‚Œã¡ã‚ƒã†R18æœ¬ã€‚<br /><br />ã€Œã‚†ã‘ã‚€ã‚Šã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒ³/B5/24P/400å††/R18ã€<br /><br />ã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼",
                "tags": [
                    "R-18",
                    "æ¼«ç”»",
                    "ãƒ†ãƒãƒª",
                    "ã‚·ã‚«ãƒ†ãƒ",
                    "ã‚·ã‚«ãƒãƒ«",
                    "å¥ˆè‰¯ã‚·ã‚«ãƒãƒ«",
                    "NARUTO",
                    "R18",
                ],
                "userId": "10002432",
                "userName": "ãƒ¢ãƒªãƒˆãƒ¼",
                "width": 2154,
                "height": 3259,
                "pageCount": 8,
                "isBookmarkable": True,
                "bookmarkData": "None",
                "alt": "ãƒ¢ãƒªãƒˆãƒ¼çš„æ¼«ç”»",
                "titleCaptionTranslation": {"workTitle": "None", "workCaption": "None"},
                "createDate": "2022-12-03T00:48:29+09:00",
                "updateDate": "2022-12-03T00:48:29+09:00",
                "isUnlisted": False,
                "isMasked": False,
                "aiType": 1,
            }
        },
        "likeData": False,
        "width": 2154,
        "height": 3259,
        "pageCount": 8,
        "bookmarkCount": 9,
        "likeCount": 6,
        "commentCount": 0,
        "responseCount": 0,
        "viewCount": 157,
        "bookStyle": "0",
        "isHowto": False,
        "isOriginal": False,
        "imageResponseOutData": [],
        "imageResponseData": [],
        "imageResponseCount": 0,
        "pollData": "None",
        "seriesNavData": "None",
        "descriptionBoothId": "None",
        "descriptionYoutubeId": "None",
        "comicPromotion": "None",
        "fanboxPromotion": "None",
        "contestBanners": [],
        "isBookmarkable": True,
        "bookmarkData": "None",
        "contestData": "None",
        "zoneConfig": {
            "responsive": {
                "url": "https://pixon.ads-pixiv.net/show?zone_id=illust_responsive_side&format=js&s=0&up=0&ng=g&l=zh&uri=%2Fajax%2Fillust%2F_PARAM_&ref=www.pixiv.net%2F&is_spa=1&ab_test_digits_first=49&uab=&yuid=NQhidIY&suid=Ph8pwvl55dpf5svzr&num=638a21ed133"
            },
            "rectangle": {
                "url": "https://pixon.ads-pixiv.net/show?zone_id=illust_rectangle&format=js&s=0&up=0&ng=g&l=zh&uri=%2Fajax%2Fillust%2F_PARAM_&ref=www.pixiv.net%2F&is_spa=1&ab_test_digits_first=49&uab=&yuid=NQhidIY&suid=Ph8pwvl55hqdfw0f4&num=638a21ed374"
            },
            "500x500": {
                "url": "https://pixon.ads-pixiv.net/show?zone_id=bigbanner&format=js&s=0&up=0&ng=g&l=zh&uri=%2Fajax%2Fillust%2F_PARAM_&ref=www.pixiv.net%2F&is_spa=1&ab_test_digits_first=49&uab=&yuid=NQhidIY&suid=Ph8pwvl55kaem69sz&num=638a21ed229"
            },
            "header": {
                "url": "https://pixon.ads-pixiv.net/show?zone_id=header&format=js&s=0&up=0&ng=g&l=zh&uri=%2Fajax%2Fillust%2F_PARAM_&ref=www.pixiv.net%2F&is_spa=1&ab_test_digits_first=49&uab=&yuid=NQhidIY&suid=Ph8pwvl55moge86of&num=638a21ed668"
            },
            "footer": {
                "url": "https://pixon.ads-pixiv.net/show?zone_id=footer&format=js&s=0&up=0&ng=g&l=zh&uri=%2Fajax%2Fillust%2F_PARAM_&ref=www.pixiv.net%2F&is_spa=1&ab_test_digits_first=49&uab=&yuid=NQhidIY&suid=Ph8pwvl55pdde2cq6&num=638a21ed745"
            },
            "expandedFooter": {
                "url": "https://pixon.ads-pixiv.net/show?zone_id=multiple_illust_viewer&format=js&s=0&up=0&ng=g&l=zh&uri=%2Fajax%2Fillust%2F_PARAM_&ref=www.pixiv.net%2F&is_spa=1&ab_test_digits_first=49&uab=&yuid=NQhidIY&suid=Ph8pwvl55rwyl3exa&num=638a21ed387"
            },
            "logo": {
                "url": "https://pixon.ads-pixiv.net/show?zone_id=logo_side&format=js&s=0&up=0&ng=g&l=zh&uri=%2Fajax%2Fillust%2F_PARAM_&ref=www.pixiv.net%2F&is_spa=1&ab_test_digits_first=49&uab=&yuid=NQhidIY&suid=Ph8pwvl55ua7qrqpd&num=638a21ed872"
            },
            "relatedworks": {
                "url": "https://pixon.ads-pixiv.net/show?zone_id=relatedworks&format=js&s=0&up=0&ng=g&l=zh&uri=%2Fajax%2Fillust%2F_PARAM_&ref=www.pixiv.net%2F&is_spa=1&ab_test_digits_first=49&uab=&yuid=NQhidIY&suid=Ph8pwvl55wlukrwb8&num=638a21ed977"
            },
        },
        "extraData": {
            "meta": {
                "title": "#ãƒ†ãƒãƒª 2022å¹´12æœˆ ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ« - ãƒ¢ãƒªãƒˆãƒ¼çš„æ¼«ç”» - pixiv",
                "description": "ã“ã®ä½œå“ ã€Œ2022å¹´12æœˆ ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«ã€ ã¯ ã€ŒR-18ã€ã€Œæ¼«ç”»ã€ ç­‰ã®ã‚¿ã‚°ãŒã¤ã‘ã‚‰ã‚ŒãŸã€Œãƒ¢ãƒªãƒˆãƒ¼ã€ã•ã‚“ã®æ¼«ç”»ã§ã™ã€‚ ã€Œ2022å¹´12æœˆæœ«ã«é€šè²©ã§é ’å¸ƒäºˆå®šã®ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚ã€Œæ¹¯ã‘ã‚€ã‚Šã¨å…µç³§ä¸¸ã€ã§ãŠäº’ã„ã«å‹˜é•ã„ã—ãŸã¾ã¾æ—…é¤¨ã«å…¥ã£ã¦ã—ã¾ã£ãŸâ€¦",
                "canonical": "https://www.pixiv.net/artworks/103287719",
                "alternateLanguages": [],
                "descriptionHeader": "æœ¬ä½œã€Œ2022å¹´12æœˆ ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«ã€ä¸ºé™„æœ‰ã€ŒR-18ã€ã€Œæ¼«ç”»ã€ç­‰æ ‡ç­¾çš„æ¼«ç”»ã€‚",
                "ogp": {
                    "description": "2022å¹´12æœˆæœ«ã«é€šè²©ã§é ’å¸ƒäºˆå®šã®ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚ã€Œæ¹¯ã‘ã‚€ã‚Šã¨å…µç³§ä¸¸ã€ã§ãŠäº’ã„ã«å‹˜é•ã„ã—ãŸã¾ã¾æ—…é¤¨ã«å…¥ã£ã¦ã—ã¾ã£ãŸã‚·ã‚«ãƒ†ãƒãŒé›°å›²æ°—ã«æµã•ã‚Œã¡ã‚ƒã†R18æœ¬ã€‚ã€Œã‚†ã‘ã‚€ã‚Šã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒ³/",
                    "image": "https://s.pximg.net/www/images/pixiv_logo.png",
                    "title": "#ãƒ†ãƒãƒª 2022å¹´12æœˆ ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ« - ãƒ¢ãƒªãƒˆãƒ¼çš„æ¼«ç”» - pixiv",
                    "type": "article",
                },
                "twitter": {
                    "description": "2022å¹´12æœˆæœ«ã«é€šè²©ã§é ’å¸ƒäºˆå®šã®ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚\n\nã€Œæ¹¯ã‘ã‚€ã‚Šã¨å…µç³§ä¸¸ã€ã§ãŠäº’ã„ã«å‹˜é•ã„ã—ãŸã¾ã¾æ—…é¤¨ã«å…¥ã£ã¦ã—ã¾ã£ãŸã‚·ã‚«ãƒ†ãƒãŒé›°å›²æ°—ã«æµã•ã‚Œã¡ã‚ƒã†R18æœ¬ã€‚\n\nã€Œã‚†ã‘ã‚€ã‚Šã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒ³/B5/24P/400å††/R18ã€\n\nã©ã†ãã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ï¼",
                    "image": "https://s.pximg.net/www/images/pixiv_logo.png",
                    "title": "[R-18]2022å¹´12æœˆ ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«",
                    "card": "summary",
                },
            }
        },
        "titleCaptionTranslation": {"workTitle": "None", "workCaption": "None"},
        "isUnlisted": False,
        "request": "None",
        "commentOff": 0,
        "aiType": 1,
        "noLoginData": {
            "breadcrumbs": {
                "successor": [],
                "current": {"zh": "2022å¹´12æœˆ ã‚·ã‚«ãƒ†ãƒæ–°åˆŠ(R18)ã‚µãƒ³ãƒ—ãƒ«"},
            },
            "zengoIdWorks": [
                {
                    "id": "103287737",
                    "title": "ä¹…å²å¿",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/49/06/103287737_p0_square1200.jpg",
                    "description": "",
                    "tags": [
                        "GenshinImpact",
                        "Genshin_Impact",
                        "åŸç¥",
                        "ä¹…å²å¿",
                        "Kuki_Shinobu",
                    ],
                    "userId": "31183597",
                    "userName": "A_Leg_",
                    "width": 1352,
                    "height": 1968,
                    "pageCount": 2,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#GenshinImpact ä¹…å²å¿ - A_Leg_çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:49:06+09:00",
                    "updateDate": "2022-12-03T00:49:06+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/11/09/12/13/22/23578725_ec24f3cab4bf8c51aa34a2df76d01973_50.jpg",
                },
                {
                    "id": "103287736",
                    "title": "ã¾ã é£Ÿã¹ã¦ãªã„ã®ã«ã‚¤ã‚¿ã‚¿",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/49/05/103287736_p0_square1200.jpg",
                    "description": "",
                    "tags": ["ãƒ†ã‚¤ãƒ«ã‚¹", "ã‚½ãƒ‹ãƒƒã‚¯"],
                    "userId": "13324",
                    "userName": "ã¡ã‚ƒãª",
                    "width": 1150,
                    "height": 3150,
                    "pageCount": 1,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#ãƒ†ã‚¤ãƒ«ã‚¹ ã¾ã é£Ÿã¹ã¦ãªã„ã®ã«ã‚¤ã‚¿ã‚¿ - ã¡ã‚ƒãªçš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:49:05+09:00",
                    "updateDate": "2022-12-03T00:49:05+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2010/09/08/11/42/18/2175035_8cd68dcaa9621ce2bbcb2d7faf8b5744_50.jpg",
                },
                {
                    "id": "103287735",
                    "title": "ãã‚†ã—ã®\u3000ãƒ„ã‚¤ãƒ­ã‚°",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/56/103287735_p0_square1200.jpg",
                    "description": "",
                    "tags": ["ãã‚†ã—ã®", "ã‚¤ãƒ©ã‚¹ãƒˆ"],
                    "userId": "77714445",
                    "userName": "ç«¹ãƒ–",
                    "width": 537,
                    "height": 537,
                    "pageCount": 56,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#ãã‚†ã—ã® ãã‚†ã—ã®\u3000ãƒ„ã‚¤ãƒ­ã‚° - ç«¹ãƒ–çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:56+09:00",
                    "updateDate": "2022-12-03T00:48:56+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/09/14/21/57/07/23332783_b444a10b81a44a823375dd204f395b86_50.jpg",
                },
                {
                    "id": "103287728",
                    "title": "ãƒ«ãƒ’ã‚¢ãƒ³ã‚†ãšã‚¢ãƒ’ãƒ«ãƒ‘ãƒ¼ã‚«ãƒ¼",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/39/103287728_p0_square1200.jpg",
                    "description": "",
                    "tags": ["ã‚ªãƒªã‚­ãƒ£ãƒ©", "ã‚·ãƒ§ã‚¿", "ãƒ‘ãƒ¼ã‚«ãƒ¼"],
                    "userId": "8860711",
                    "userName": "ğŸ¯â„",
                    "width": 600,
                    "height": 450,
                    "pageCount": 1,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#ã‚ªãƒªã‚­ãƒ£ãƒ© ãƒ«ãƒ’ã‚¢ãƒ³ã‚†ãšã‚¢ãƒ’ãƒ«ãƒ‘ãƒ¼ã‚«ãƒ¼ - ğŸ¯â„çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:39+09:00",
                    "updateDate": "2022-12-03T00:48:39+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/05/26/22/20/24/22782147_101be21f5d6bcf44b4bb9b51f2116b32_50.jpg",
                },
                {
                    "id": "103287727",
                    "title": "AI Art #15",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/39/103287727_p0_square1200.jpg",
                    "description": "",
                    "tags": ["StableDiffusion", "AIã‚¤ãƒ©ã‚¹ãƒˆ", "AI"],
                    "userId": "88619035",
                    "userName": "zer0",
                    "width": 512,
                    "height": 512,
                    "pageCount": 1,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#StableDiffusion AI Art #15 - zer0çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:39+09:00",
                    "updateDate": "2022-12-03T00:48:39+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 2,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/12/01/01/58/23/23681821_f2456b849fb2441d370a335707b2cbc3_50.jpg",
                },
                {
                    "id": "103287723",
                    "title": "ãƒšãƒ«ã‚½ãƒŠ5",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/35/103287723_p0_square1200.jpg",
                    "description": "",
                    "tags": ["ãƒšãƒ«ã‚½ãƒŠ5", "é›¨å®®è“®", "fanart"],
                    "userId": "64693958",
                    "userName": "é£ç­ç¬‘",
                    "width": 826,
                    "height": 1023,
                    "pageCount": 2,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#ãƒšãƒ«ã‚½ãƒŠ5 ãƒšãƒ«ã‚½ãƒŠ5 - é£ç­ç¬‘çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:35+09:00",
                    "updateDate": "2022-12-03T00:48:35+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 0,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/09/08/07/19/59/23303914_5fbc281701791352426077af72eff83a_50.jpg",
                },
                {
                    "id": "103287722",
                    "title": "Three sisters",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/34/103287722_p0_square1200.jpg",
                    "description": "",
                    "tags": ["NovelAI", "è¡€", "æµè¡€æ³¨æ„"],
                    "userId": "28201510",
                    "userName": "Oracle",
                    "width": 512,
                    "height": 1024,
                    "pageCount": 3,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#NovelAI Three sisters - Oracleçš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:34+09:00",
                    "updateDate": "2022-12-03T00:48:34+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 2,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/12/02/14/44/04/23687528_7441ff8a7ecac4f68ce7c97c22c03950_50.png",
                },
                {
                    "id": "103287721",
                    "title": "åŒæ£²ã—ã¦ã‚‹ãƒ¬ã‚¤ã‚¨ãƒ",
                    "illustType": 1,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/custom-thumb/img/2022/12/03/00/48/32/103287721_p0_custom1200.jpg",
                    "description": "",
                    "tags": ["æ¼«ç”»", "ãƒ¬ã‚¤ã‚¨ãƒ"],
                    "userId": "88060587",
                    "userName": "ã¯ã‚Š",
                    "width": 874,
                    "height": 1240,
                    "pageCount": 4,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#ãƒ¬ã‚¤ã‚¨ãƒ åŒæ£²ã—ã¦ã‚‹ãƒ¬ã‚¤ã‚¨ãƒ - ã¯ã‚Šçš„æ¼«ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:32+09:00",
                    "updateDate": "2022-12-03T00:48:32+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/11/14/14/08/22/23602666_6e57784641bcc503eace5840732367f0_50.png",
                },
                {
                    "id": "103287716",
                    "title": "é›·å¤§ç‚®",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/25/103287716_p0_square1200.jpg",
                    "description": "",
                    "tags": ["åŸç¥", "äºŒåˆ›", "æ•£å…µ"],
                    "userId": "76382246",
                    "userName": "æä»è±†è…ç¾¹",
                    "width": 271,
                    "height": 359,
                    "pageCount": 1,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#åŸç¥ é›·å¤§ç‚® - æä»è±†è…ç¾¹çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:25+09:00",
                    "updateDate": "2022-12-03T00:48:25+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 0,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/12/03/00/42/19/23689574_24affbcdcf34b5f1e5ed62453908f3be_50.jpg",
                },
                {
                    "id": "103287713",
                    "title": "Fruit Picking",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/07/103287713_p0_square1200.jpg",
                    "description": "",
                    "tags": [
                        "nosferatu16",
                        "ssbbw",
                        "naÃ¯a",
                        "Konan",
                        "ã‚±ãƒ¢ãƒ",
                        "ãƒ‡ãƒ–ã‚±ãƒ¢",
                        "è‚‰å¡Š",
                        "çŒ«",
                        "éƒ¨æ—",
                        "ç­‹è‚‰",
                    ],
                    "userId": "4889790",
                    "userName": "nosferatu16",
                    "width": 984,
                    "height": 812,
                    "pageCount": 1,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#nosferatu16 Fruit Picking - nosferatu16çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:07+09:00",
                    "updateDate": "2022-12-03T00:48:07+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2021/10/14/02/45/43/21576567_18eff0f1bd6bcfb36d7b03050ad8a58f_50.png",
                },
                {
                    "id": "103287710",
                    "title": "é’é«ª",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/05/103287710_p0_square1200.jpg",
                    "description": "",
                    "tags": ["ã‚ªãƒªã‚¸ãƒŠãƒ«ç”·å­", "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ãƒãƒ¼ã‚«ãƒ¼", "ã‚¢ãƒŠãƒ­ã‚°ã‚¤ãƒ©ã‚¹ãƒˆ", "ã‚ªãƒªã‚¸ãƒŠ"],
                    "userId": "66440133",
                    "userName": "ã‚ã¾ãã‚‰",
                    "width": 767,
                    "height": 1024,
                    "pageCount": 1,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#ã‚ªãƒªã‚¸ãƒŠãƒ«ç”·å­ é’é«ª - ã‚ã¾ãã‚‰çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:05+09:00",
                    "updateDate": "2022-12-03T00:48:05+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://s.pximg.net/common/images/no_profile_s.png",
                },
                {
                    "id": "103287704",
                    "title": "ç„¡é¡Œ",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/02/103287704_p0_square1200.jpg",
                    "description": "",
                    "tags": ["ã‚ªãƒªã‚¸ãƒŠãƒ«"],
                    "userId": "28350084",
                    "userName": "WarmGray",
                    "width": 3000,
                    "height": 3600,
                    "pageCount": 1,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#ã‚ªãƒªã‚¸ãƒŠãƒ« ç„¡é¡Œ - WarmGrayçš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:02+09:00",
                    "updateDate": "2022-12-03T00:48:02+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/12/03/00/31/48/23689534_ff73fdec94466911e541e3ca3f49e3db_50.jpg",
                },
                {
                    "id": "103287702",
                    "title": "ã‚´ã‚¸ãƒ¼ã‚¿ãƒ–ãƒ«ãƒ¼",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/48/01/103287702_p0_square1200.jpg",
                    "description": "",
                    "tags": ["è¶…ã‚µã‚¤ãƒ¤äººSS", "ã‚´ã‚¸ãƒ¼ã‚¿", "ãƒ‰ãƒ©ã‚´ãƒ³ãƒœãƒ¼ãƒ«"],
                    "userId": "61445737",
                    "userName": "Taiga",
                    "width": 2894,
                    "height": 4093,
                    "pageCount": 2,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#è¶…ã‚µã‚¤ãƒ¤äººSS ã‚´ã‚¸ãƒ¼ã‚¿ãƒ–ãƒ«ãƒ¼ - Taigaçš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:48:01+09:00",
                    "updateDate": "2022-12-03T00:48:01+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/04/03/05/36/31/22488859_fe589439e866d2559056797d4573b622_50.jpg",
                },
                {
                    "id": "103287699",
                    "title": "ã‚­ãƒ£ãƒ©ãƒ‡ã‚¶",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/47/54/103287699_p0_square1200.jpg",
                    "description": "",
                    "tags": ["ã‚ªãƒªã‚¸ãƒŠãƒ«"],
                    "userId": "170506",
                    "userName": "ãƒãƒ¯ãƒ¯ã‚¦ãƒ‰ãƒ³",
                    "width": 2540,
                    "height": 3560,
                    "pageCount": 1,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#ã‚ªãƒªã‚¸ãƒŠãƒ« ã‚­ãƒ£ãƒ©ãƒ‡ã‚¶ - ãƒãƒ¯ãƒ¯ã‚¦ãƒ‰ãƒ³çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:47:54+09:00",
                    "updateDate": "2022-12-03T00:47:54+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 1,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2019/01/10/02/41/22/15239165_3ae507b4ade6aea204cbd0bf15ecb201_50.jpg",
                },
                {
                    "id": "103287698",
                    "title": "ãµã‚ãµã‚ãã‚‰ãã‚‰ã®ãŠã‚“ãªã®ã“",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/47/54/103287698_p0_square1200.jpg",
                    "description": "",
                    "tags": ["ã‚ªãƒªã‚¸ãƒŠãƒ«", "nijijourney", "å¥³ã®å­", "ç™¾åˆ"],
                    "userId": "88269378",
                    "userName": "ã­ã‚€/NovelAI",
                    "width": 450,
                    "height": 676,
                    "pageCount": 63,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#ã‚ªãƒªã‚¸ãƒŠãƒ« ãµã‚ãµã‚ãã‚‰ãã‚‰ã®ãŠã‚“ãªã®ã“ - ã­ã‚€/NovelAIçš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:47:54+09:00",
                    "updateDate": "2022-12-03T00:47:54+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 2,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/11/25/16/18/12/23656063_2000491510033ad7a320078823f048db_50.png",
                },
                {
                    "id": "103287695",
                    "title": "AI Art #14",
                    "illustType": 0,
                    "xRestrict": 0,
                    "restrict": 0,
                    "sl": 2,
                    "url": "https://i.pximg.net/c/250x250_80_a2/img-master/img/2022/12/03/00/47/50/103287695_p0_square1200.jpg",
                    "description": "",
                    "tags": ["StableDiffusion", "AIã‚¤ãƒ©ã‚¹ãƒˆ", "AI"],
                    "userId": "88619035",
                    "userName": "zer0",
                    "width": 512,
                    "height": 512,
                    "pageCount": 1,
                    "isBookmarkable": True,
                    "bookmarkData": "None",
                    "alt": "#StableDiffusion AI Art #14 - zer0çš„æ’ç”»",
                    "titleCaptionTranslation": {
                        "workTitle": "None",
                        "workCaption": "None",
                    },
                    "createDate": "2022-12-03T00:47:50+09:00",
                    "updateDate": "2022-12-03T00:47:50+09:00",
                    "isUnlisted": False,
                    "isMasked": False,
                    "aiType": 2,
                    "profileImageUrl": "https://i.pximg.net/user-profile/img/2022/12/01/01/58/23/23681821_f2456b849fb2441d370a335707b2cbc3_50.jpg",
                },
            ],
            "zengoWorkData": {
                "nextWork": {"id": "103287721", "title": "åŒæ£²ã—ã¦ã‚‹ãƒ¬ã‚¤ã‚¨ãƒ"},
                "prevWork": {"id": "103287718", "title": "round 6  Rachel vs liu"},
            },
        },
    }


async def test_get_metadata(session):
    res = await get_metadata(session, "103287719")
    assert res["id"] == "103287719"
    assert "tags" in res


async def test_get_metadata_error(session):
    with pytest.raises(Exception, match="Download Metadata Error"):
        await get_metadata(session, "123123213")


def test_extract_tags(metadata):
    tags = extract_tags(metadata)
    assert "manga" in tags
    assert "R-18" in tags


def test_extra_tags_artist(metadata):
    extra = get_extra_tags(metadata)
    assert "Artist:10002432" in extra


@pytest.mark.parametrize(
    "bookmark,expected",
    [
        (12000, "BookmarkCount:10000+"),
        (9000, "BookmarkCount:5000+"),
        (4000, "BookmarkCount:1000+"),
    ],
)
def test_extra_tags_bookmark(metadata, bookmark, expected):
    metadata["bookmarkCount"] = bookmark
    tags = get_extra_tags(metadata)
    assert expected in tags


@pytest.mark.parametrize(
    "name,expected",
    [
        ("AGirl93596051.png", "93596051"),
        ("AGirl93596051_p1.png", "93596051"),
        ("2020_78621230.jpg", "78621230"),
        ("2020_78621230_p0.jpg", "78621230"),
        ("A20123_1234.jpg", "1234"),
        ("A20123_1234_p1.jpg", "1234"),
        ("sad123_p3.jpg", "123"),
        ("2_1_p0.jpg", "1"),
    ],
)
def test_get_pid(name, expected):
    res = get_pid(name)
    assert res == expected
